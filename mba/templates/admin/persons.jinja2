
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        {% include "inc/css.jinja2" %}

        <style type="text/css">
            #pjax-content {
                /*border: solid 1px #dcdcdc;*/
            }
        </style>


        <script src="fanstatic/mba/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->



        {% include "header.jinja2" %}





         <div class="mba-margin-top">

            <div class="container ">
                <br/>
                <div class="row">

                    <div class="col-md-3">

                        {%  include "/admin/menu.jinja2" %}

                    </div>

                    <div class="col-md-9">

                         {% include "messages.jinja2" %}

                        <h2>所有用户</h2>

                        {% include "/admin/pagination.jinja2" %}

                        <form name="persons_mgmt"  method="POST" >

                        <table class="table table-striped table-bordered">
                            <tr>
                                <th>ID</th>
                                <th>用户名</th>
                                <th>邮箱</th>
                                <th>姓名</th>
                                <th>激活状态</th>
                                <th>资料认证</th>
                                <th>用户种类</th>
                                <th>用户组</th>
                                <th>操作</th>
                            </tr>
                            {% for person in persons %}
                                <tr>
                                    <td><a style="text-decoration: underline;color: #0000ff" target="_blank" href="/person/{{ person.id }}">{{ person.id }}</a></td>
                                    <td>{{ person.name }}</td>
                                    <td>{{ person.email }}</td>
                                    <td>{{ person.real_name }}</td>
                                    <td>{{ person.active }}</td>
                                    <td>{% if person.auth_info == 0 %}
                                            未认证
                                        {% elif person.auth_info == 1 %}
                                            认证通过
                                        {% elif person.auth_info == 2%}
                                            认证不通过
                                        {% else %}
                                            未知状态
                                        {% endif %}
                                    </td>
                                    <td>{{ person.type }}</td>
                                    <td>{{ person.groups }}</td>
                                    <td>
                                        {% if person.auth_info in [0,2] %}
                                            <button class="person-iauth" name="pass-iauth" id="pass-iauth-{{ person.id }}" value="{{ person.id }}" >通过认证</button>
                                            <button class="person-iauth" name="fail-iauth" id="fail-iauth-{{ person.id }}" value="{{ person.id }}" >不通过认证</button>
                                        {% else %}
                                            <button class="person-iauth" name="cancel-iauth" id="cancel-iauth-{{ person.id }}" value="{{ person.id }}" >取消认证</button>

                                        {% endif %}
                                    </td>

                                </tr>

                            {% endfor %}

                        </table>




                        </form>

                    </div>


                </div>
            </div>
        </div>


        {% include "footer.jinja2" %}



        {% include "inc/js.jinja2" %}


        <script type="text/javascript">
            $(function(){

               $("li#li_admin").parent().find("li").removeClass("active");
               $("li#li_admin").addClass("active");


                function do_job(method, options, callback){

                    $.extend(options, {'method':method});
                    $.post('/admin/persons',options, callback);

                }



                $('.person-iauth').click(function(){
                    var self = this;
                    var method = $(this).attr('name');
                    var personid = $(this).val();
                    do_job(method,{'person-id':personid },function(ret){
                            window.location.reload();
                    });
                    return false;
                 });

            });
        </script>





    </body>
</html>
